{
    "version": "https://jsonfeed.org/version/1",
    "title": "KAIIAK • All posts by \"nsq\" tag",
    "description": null,
    "home_page_url": "https://blog.iakmai.com",
    "items": [
        {
            "id": "https://blog.iakmai.com/2018/07/25/set_nsq_env_and_use/",
            "url": "https://blog.iakmai.com/2018/07/25/set_nsq_env_and_use/",
            "title": "NSQ环境的搭建和简单的使用",
            "date_published": "2018-07-25T14:47:30.000Z",
            "content_html": "<h2 id=\"NSQ安装说明\"><a href=\"#NSQ安装说明\" class=\"headerlink\" title=\"NSQ安装说明\"></a>NSQ安装说明</h2><h3 id=\"使用docker-compose运行\"><a href=\"#使用docker-compose运行\" class=\"headerlink\" title=\"使用docker-compose运行\"></a>使用docker-compose运行</h3><p>如果使用<code>docker-compose</code>的方式运行<code>nsq</code>,首先要保证<code>Consumer</code>要与nsq服务在一个docker网络环境中。<br>如果不能保证在一个网络环境中，则需要从源代码安装。<br>如果要存储<code>nsq</code>的消息，需要在启动<code>nsqd</code>的时候加上<code>--data-path=/data</code>命令，并在<code>docker</code>\b配置文件中将<code>/data</code>使用<code>-v</code>或<code>--volume</code>命令挂载到本地\b。<br>使用<code>docker-compose up -d</code>后台运行。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">'3'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">nsqlookupd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsq-network</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"4161:4161\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"4160:4160\"</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqlookupd</span></span><br><span class=\"line\">  <span class=\"attr\">nsqd:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">nsqd</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./data:/data</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsq-network</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"4151:4151\"</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"4150:4150\"</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqd</span> <span class=\"string\">--broadcast-address=nsqd</span> <span class=\"string\">--lookupd-tcp-address=nsqlookupd:4160</span> <span class=\"string\">--data-path=/data</span></span><br><span class=\"line\">  <span class=\"attr\">nsqadmin:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nsqio/nsq</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsqlookupd</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">nsqadmin</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">\"4171:4171\"</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">nsq-network</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">/nsqadmin</span> <span class=\"string\">--lookupd-http-address=nsqlookupd:4161</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">nsq-network:</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行的独立的docker\"><a href=\"#运行的独立的docker\" class=\"headerlink\" title=\"运行的独立的docker\"></a>运行的独立的docker</h3><ol>\n<li>从dokcer hub拉取最新的镜像<code>docker pull nsqio/nsq</code></li>\n<li>运行<code>nsqlookupd</code><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name lookupd -p 4160:4160 -p 4161:4161 nsqio/nsq /nsqlookupd</span><br></pre></td></tr></table></figure></li>\n<li>运行<code>nsqd</code>,需要手动挂载<code>volume</code><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -v ./data:/data --name nsqd -p 4150:4150 -p 4151:4151 \\</span><br><span class=\"line\">    nsqio/nsq /nsqd \\</span><br><span class=\"line\">    --broadcast-address=127.0.0.1 \\</span><br><span class=\"line\">    --lookupd-tcp-address=127.0.0.1:4160 \\</span><br><span class=\"line\">    --data-path=/data</span><br></pre></td></tr></table></figure></li>\n<li>运行<code>nsqadmin</code><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name nsqadmin -p 4171:4171 \\</span><br><span class=\"line\">    nsqio/nsq /nsqadmin \\</span><br><span class=\"line\">    --lookupd-http-address=127.0.0.1:4161</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"从源代码安装\"><a href=\"#从源代码安装\" class=\"headerlink\" title=\"从源代码安装\"></a>从源代码安装</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/nsqio/nsq $GOPATH/src/github.com/nsqio/nsq</span><br><span class=\"line\">cd $GOPATH/src/github.com/nsqio/nsq</span><br><span class=\"line\">dep ensure</span><br><span class=\"line\">go install</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动nsqlookupd\"><a href=\"#启动nsqlookupd\" class=\"headerlink\" title=\"启动\bnsqlookupd\"></a>启动\bnsqlookupd</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nsqlookupd</span><br></pre></td></tr></table></figure>\n<h4 id=\"启动nsq\"><a href=\"#启动nsq\" class=\"headerlink\" title=\"启动nsq\"></a>启动nsq</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nsqd –lookupd-tcp-address=127.0.0.1:4160 --broadcast-address=127.0.0.1 --data-path=/data</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动nsqadmin\"><a href=\"#启动nsqadmin\" class=\"headerlink\" title=\"启动nsqadmin\"></a>启动nsqadmin</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nsqadmin --lookupd-http-address=127.0.0.1:4161</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "DOCKER",
                "NSQ"
            ]
        }
    ]
}