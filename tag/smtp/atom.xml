<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.iakmai.com</id>
    <title>KAIIAK • Posts by &#34;smtp&#34; tag</title>
    <link href="https://blog.iakmai.com" />
    <updated>2017-02-28T16:16:30.000Z</updated>
    <category term="Linux" />
    <category term="APUE" />
    <category term="随笔" />
    <category term="vim" />
    <category term="YouCompleteMe" />
    <category term="C" />
    <category term="ACM" />
    <category term="ZOJ" />
    <category term="GOLANG" />
    <category term="SMTP" />
    <category term="Eclipse" />
    <category term="PyDev" />
    <category term="NSQ" />
    <category term="DOCKER" />
    <category term="sqlite" />
    <category term="tree" />
    <category term="vlc" />
    <category term="CSharp" />
    <category term="Python" />
    <category term="树莓派" />
    <category term="PRI.GPIO" />
    <category term="Xshell" />
    <category term="lirc" />
    <category term="openWRT" />
    <category term="Hexo主题" />
    <category term="pylirc" />
    <category term="FFMPEG" />
    <entry>
        <id>https://blog.iakmai.com/2017/03/01/golang_smtp/</id>
        <title>Golang踩坑小结之SMTP</title>
        <link rel="alternate" href="https://blog.iakmai.com/2017/03/01/golang_smtp/"/>
        <content type="html">&lt;h1 id=&#34;smtp之golang标准库&#34;&gt;&lt;a href=&#34;#smtp之golang标准库&#34; class=&#34;headerlink&#34; title=&#34;smtp之golang标准库&#34;&gt;&lt;/a&gt;smtp之golang标准库&lt;/h1&gt;&lt;p&gt;函数&lt;code&gt;SendMail&lt;/code&gt;就是标准库里面最简单的发送邮件的方法。&lt;/p&gt;
&lt;figure class=&#34;highlight golang&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;SendMail&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(addr &lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt;, a Auth, from &lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt;, to []&lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt;, msg []&lt;span class=&#34;keyword&#34;&gt;byte&lt;/span&gt;)&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;error&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;对不熟悉smtp协议的小伙伴来说，最难的地方就是构造&lt;code&gt;msg&lt;/code&gt;了。&lt;br&gt;在指定&lt;code&gt;smtp&lt;/code&gt;的&lt;a href=&#34;https://tools.ietf.org/html/rfc5321&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC531&lt;/a&gt;中，定义了&lt;code&gt;smtp&lt;/code&gt;客户端和服务器的通讯方式和报文的格式。&lt;/p&gt;
&lt;h2 id=&#34;缺陷&#34;&gt;&lt;a href=&#34;#缺陷&#34; class=&#34;headerlink&#34; title=&#34;缺陷&#34;&gt;&lt;/a&gt;缺陷&lt;/h2&gt;&lt;p&gt;现在的邮件服务器除了&lt;code&gt;25&lt;/code&gt;端口外，还采用了其他的默认采用TLS的端口（只能TLS连接）。&lt;br&gt;但是标准库还会发送&lt;code&gt;STARTTLS&lt;/code&gt;命令，但是服务器不会回应，这样就产生了阻塞。&lt;br&gt;以下是直接通过tls端口发送邮件的代码。&lt;/p&gt;
&lt;figure class=&#34;highlight golang&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// SendMailTLS not use STARTTLS commond&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;SendMailTLS&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(addr &lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt;, auth smtp.Auth, from &lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt;, to []&lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt;, msg []&lt;span class=&#34;keyword&#34;&gt;byte&lt;/span&gt;)&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;error&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	host, _, err := net.SplitHostPort(addr)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	tlsconfig := &amp;amp;tls.Config&amp;#123;ServerName: host&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err = validateLine(from); err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; _, recp := &lt;span class=&#34;keyword&#34;&gt;range&lt;/span&gt; to &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err = validateLine(recp); err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	conn, err := tls.Dial(&lt;span class=&#34;string&#34;&gt;&#34;tcp&#34;&lt;/span&gt;, addr, tlsconfig)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;defer&lt;/span&gt; conn.Close()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	c, err := smtp.NewClient(conn, host)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;defer&lt;/span&gt; c.Close()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err = c.Hello(&lt;span class=&#34;string&#34;&gt;&#34;localhost&#34;&lt;/span&gt;); err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err = c.Auth(auth); err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err = c.Mail(from); err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; _, addr := &lt;span class=&#34;keyword&#34;&gt;range&lt;/span&gt; to &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err = c.Rcpt(addr); err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	w, err := c.Data()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	_, err = w.Write(msg)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	err = w.Close()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; err != &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; err&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; c.Quit()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// validateLine checks to see if a line has CR or LF as per RFC 5321&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;validateLine&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(line &lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt;)&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;error&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; strings.ContainsAny(line, &lt;span class=&#34;string&#34;&gt;&#34;\n\r&#34;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; errors.New(&lt;span class=&#34;string&#34;&gt;&#34;a line must not contain CR or LF&#34;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&#34;MIME&#34;&gt;&lt;a href=&#34;#MIME&#34; class=&#34;headerlink&#34; title=&#34;MIME&#34;&gt;&lt;/a&gt;MIME&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;多用途互联网邮件扩展（MIME，Multipurpose Internet Mail Extensions）是一个互联网标准，它扩展了电子邮件标准，使其能够支援：&lt;br&gt;非ASCII字符文本；&lt;br&gt;非文本格式附件（二进制、声音、图像等）；&lt;br&gt;由多部分（multiple parts）组成的消息体；&lt;br&gt;包含非ASCII字符的头信息（Header information）。这个标准被定义在RFC 2045、RFC 2046、RFC 2047、RFC 2048、RFC 2049等RFC中。&lt;br&gt;MIME改善了由RFC 822转变而来的RFC 2822，这些旧标准规定电子邮件标准并不允许在邮件消息中使用7位ASCII字符集以外的字符。正因如此，一些非英语字符消息和二进制文件，图像，声音等非文字消息原本都不能在电子邮件中传输（MIME可以）。MIME规定了用于表示各种各样的数据类型的符号化方法。此外，在万维网中使用的HTTP协议中也使用了MIME的框架，标准被扩展为互联网媒体类型。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;基本格式&#34;&gt;&lt;a href=&#34;#基本格式&#34; class=&#34;headerlink&#34; title=&#34;基本格式&#34;&gt;&lt;/a&gt;基本格式&lt;/h2&gt;&lt;figure class=&#34;highlight plain&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;MIME-Version: 1.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: text&amp;#x2F;plain&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-transfer-encoding: base64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;boundary &amp;#x3D; XXXXXXXXXXXXXXXXX&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--XXXXXXXXXXXXXXXXX&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;base64 string&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--XXXXXXXXXXXXXXXXX&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;base64 string&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&#34;邮件格式&#34;&gt;&lt;a href=&#34;#邮件格式&#34; class=&#34;headerlink&#34; title=&#34;邮件格式&#34;&gt;&lt;/a&gt;邮件格式&lt;/h1&gt;&lt;h2 id=&#34;基本字段&#34;&gt;&lt;a href=&#34;#基本字段&#34; class=&#34;headerlink&#34; title=&#34;基本字段&#34;&gt;&lt;/a&gt;基本字段&lt;/h2&gt;&lt;figure class=&#34;highlight plain&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;From:来自测试发送&amp;lt;aNxFi37X@outlook.com&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;To:aNxFi37X@outlook.com&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Date:27 Mar 17 00:45 +0800&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Cc:aNxFi37X@outlook.com&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Subject: TEST&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;bcc&#34;&gt;&lt;a href=&#34;#bcc&#34; class=&#34;headerlink&#34; title=&#34;bcc&#34;&gt;&lt;/a&gt;bcc&lt;/h2&gt;&lt;p&gt;密送的实现很好玩，在邮件内容里不填写信息，但是发送的时候发送给密送的那个人。&lt;br&gt;这里的设计很巧妙。&lt;/p&gt;
&lt;h2 id=&#34;&#34;&gt;&lt;a href=&#34;#&#34; class=&#34;headerlink&#34; title=&#34;&#34;&gt;&lt;/a&gt;&lt;CRLF&gt;&lt;/h2&gt;&lt;p&gt;以上的每一项都以&lt;code&gt;&amp;lt;CRLF&amp;gt;&lt;/code&gt;结束，即&lt;code&gt;\r\n&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&#34;邮件内容&#34;&gt;&lt;a href=&#34;#邮件内容&#34; class=&#34;headerlink&#34; title=&#34;邮件内容&#34;&gt;&lt;/a&gt;邮件内容&lt;/h2&gt;&lt;p&gt;这里使用MIME，当然也可以使用&lt;code&gt;8BITMIME&lt;/code&gt;发送多媒体内容。&lt;br&gt;具体的方式是创建一个MIME part，每个part里面设置自己的&lt;code&gt;Content-Disposition&lt;/code&gt;、&lt;code&gt;Content-Transfer-Encoding&lt;/code&gt;、&lt;code&gt;Content-Type&lt;/code&gt;。&lt;br&gt;&lt;code&gt;Content-Transfer-Encoding&lt;/code&gt;使用base64编码，不然直接发送&lt;code&gt;ascii&lt;/code&gt;中含有&lt;code&gt;\r\n.\r\n&lt;/code&gt;，邮件就直接结束了。&lt;br&gt;虽然编码率高了不少，但是简单，易操作，不依赖服务器支持&lt;code&gt;8BITMIME&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&#34;邮件样例&#34;&gt;&lt;a href=&#34;#邮件样例&#34; class=&#34;headerlink&#34; title=&#34;邮件样例&#34;&gt;&lt;/a&gt;邮件样例&lt;/h2&gt;&lt;figure class=&#34;highlight plain&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;From:来自测试发送&amp;lt;aNxFi37X@outlook.com&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;To:aNxFi37X@outlook.com&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Date:27 Mar 17 00:45 +0800&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Cc:aNxFi37X@outlook.com&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Subject:&amp;#x3D;?UTF-8?B?5rWL6K+V?&amp;#x3D;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: multipart&amp;#x2F;mixed; boundary&amp;#x3D;5b83f06665140150554c5847a8a3b05a5a9d64f5ec6a42fec16a4460223c&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MIME-Version: 1.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--5b83f06665140150554c5847a8a3b05a5a9d64f5ec6a42fec16a4460223c&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Transfer-Encoding: base64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: text&amp;#x2F;html&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PHA+6L+Z5piv5LiA5bCB5rWL6K+V6YKu5Lu2PC9wPg&amp;#x3D;&amp;#x3D;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--5b83f06665140150554c5847a8a3b05a5a9d64f5ec6a42fec16a4460223c&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Disposition: attachment; filename&amp;#x3D;&amp;quot;&amp;#x3D;?UTF-8?B?MS50eHQ&amp;#x3D;?&amp;#x3D;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Transfer-Encoding: base64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application&amp;#x2F;application&amp;#x2F;octet-stream&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MS50eHQ&amp;#x3D;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--5b83f06665140150554c5847a8a3b05a5a9d64f5ec6a42fec16a4460223c&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Disposition: attachment; filename&amp;#x3D;&amp;quot;&amp;#x3D;?UTF-8?B?Mi50eHQ&amp;#x3D;?&amp;#x3D;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Transfer-Encoding: base64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application&amp;#x2F;application&amp;#x2F;octet-stream&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Mi50eHQ&amp;#x3D;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&#34;发送过程&#34;&gt;&lt;a href=&#34;#发送过程&#34; class=&#34;headerlink&#34; title=&#34;发送过程&#34;&gt;&lt;/a&gt;发送过程&lt;/h1&gt;&lt;figure class=&#34;highlight plain&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;S: 220 xyz.com Simple Mail Transfer Service Ready&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: EHLO foo.com&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;S: 250 xyz.com is on the air&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: MAIL FROM:&amp;lt;@foo.com:JQP@bar.com&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;S: 250 OK&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: RCPT TO:&amp;lt;Jones@XYZ.COM&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;S: 250 OK&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: DATA&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;S: 354 Start mail input; end with &amp;lt;CRLF&amp;gt;.&amp;lt;CRLF&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: Received: from bar.com by foo.com ; Thu, 21 May 1998&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C:     05:33:29 -0700&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: Date: Thu, 21 May 1998 05:33:22 -0700&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: From: John Q. Public &amp;lt;JQP@bar.com&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: Subject:  The Next Meeting of the Board&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: To: Jones@xyz.com&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: Bill:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: The next meeting of the board of directors will be&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: on Tuesday.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C:                         John.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: .&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;S: 250 OK&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C: QUIT&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;S: 221 foo.com Service closing transmission channel&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;HELO-or-EHLO&#34;&gt;&lt;a href=&#34;#HELO-or-EHLO&#34; class=&#34;headerlink&#34; title=&#34;HELO or EHLO&#34;&gt;&lt;/a&gt;HELO or EHLO&lt;/h2&gt;&lt;p&gt;确定服务器可用&lt;/p&gt;
&lt;h2 id=&#34;MAIL&#34;&gt;&lt;a href=&#34;#MAIL&#34; class=&#34;headerlink&#34; title=&#34;MAIL&#34;&gt;&lt;/a&gt;MAIL&lt;/h2&gt;&lt;p&gt;声明发信邮箱&lt;/p&gt;
&lt;h2 id=&#34;RCPT&#34;&gt;&lt;a href=&#34;#RCPT&#34; class=&#34;headerlink&#34; title=&#34;RCPT&#34;&gt;&lt;/a&gt;RCPT&lt;/h2&gt;&lt;p&gt;声明收件邮箱。密送的邮箱就是在这里声明，但是不写在邮件内容里面。&lt;/p&gt;
&lt;h2 id=&#34;DATA&#34;&gt;&lt;a href=&#34;#DATA&#34; class=&#34;headerlink&#34; title=&#34;DATA&#34;&gt;&lt;/a&gt;DATA&lt;/h2&gt;&lt;p&gt;发送邮件的内容。&lt;/p&gt;
&lt;h2 id=&#34;QUIT&#34;&gt;&lt;a href=&#34;#QUIT&#34; class=&#34;headerlink&#34; title=&#34;QUIT&#34;&gt;&lt;/a&gt;QUIT&lt;/h2&gt;&lt;p&gt;结束发送，并关闭连接。&lt;/p&gt;
&lt;h1 id=&#34;拓展命令&#34;&gt;&lt;a href=&#34;#拓展命令&#34; class=&#34;headerlink&#34; title=&#34;拓展命令&#34;&gt;&lt;/a&gt;拓展命令&lt;/h1&gt;&lt;h2 id=&#34;STARTLTLS&#34;&gt;&lt;a href=&#34;#STARTLTLS&#34; class=&#34;headerlink&#34; title=&#34;STARTLTLS&#34;&gt;&lt;/a&gt;STARTLTLS&lt;/h2&gt;&lt;p&gt;试探服务器是否支持TLS。&lt;/p&gt;
&lt;h2 id=&#34;8BITMIME&#34;&gt;&lt;a href=&#34;#8BITMIME&#34; class=&#34;headerlink&#34; title=&#34;8BITMIME&#34;&gt;&lt;/a&gt;8BITMIME&lt;/h2&gt;&lt;p&gt;试探服务器是否支持8字长的编码。&lt;/p&gt;
&lt;h2 id=&#34;其他&#34;&gt;&lt;a href=&#34;#其他&#34; class=&#34;headerlink&#34; title=&#34;其他&#34;&gt;&lt;/a&gt;其他&lt;/h2&gt;&lt;p&gt;其他的命令没有使用，这里挖个坑。&lt;/p&gt;
&lt;center&gt;
一篇文章从一号拖到现在，真的好丢人啊。
多谢您花费时间阅读我的文章，有不好的地方欢迎指正。
&lt;/center&gt;</content>
        <category term="GOLANG" />
        <category term="SMTP" />
        <updated>2017-02-28T16:16:30.000Z</updated>
    </entry>
</feed>
